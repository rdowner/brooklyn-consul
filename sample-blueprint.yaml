location: vagrant-virtualbox
services:
- type: consul-server-cluster
  name: Consul Server Cluster
  id: consul-server-cluster
  brooklyn.config:
    initialSize: 2
- type: server
  brooklyn.config:
    children.startable.mode: foreground
  brooklyn.children:
    - type: consul-agent-mixin
      id: consul-agent-mixin
      brooklyn.config:
        consul.joinToken: $brooklyn:entity("consul-server-cluster").attributeWhenReady("consul.joinToken")
